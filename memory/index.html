<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Memory Game Card Generator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background-color: #f3f4f6;
      min-height: 100vh;
      padding: 24px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
    }

    h1 {
      font-size: 28px;
      color: #1f2937;
      margin-bottom: 8px;
    }

    .subtitle {
      color: #6b7280;
      margin-bottom: 24px;
    }

    .card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      padding: 24px;
      margin-bottom: 24px;
    }

    .card h2 {
      font-size: 18px;
      color: #374151;
      margin-bottom: 16px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 18px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .btn-success {
      background: #16a34a;
      color: white;
    }

    .btn-success:hover {
      background: #15803d;
    }

    .btn-danger {
      background: transparent;
      color: #ef4444;
      padding: 8px;
    }

    .btn-danger:hover {
      background: #fef2f2;
    }

    .header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      flex-wrap: wrap;
      gap: 12px;
    }

    .pairs-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .pair-item {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px;
      background: #f9fafb;
      border-radius: 8px;
    }

    .pair-number {
      font-size: 14px;
      font-weight: 500;
      color: #6b7280;
      width: 32px;
    }

    .pair-content {
      display: flex;
      align-items: center;
      gap: 16px;
      flex: 1;
    }

    .pair-image {
      width: 100px;
      height: 140px;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      background: white;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      flex-shrink: 0;
    }

    .pair-image img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .pair-text-input {
      flex: 1;
      padding: 10px 14px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 14px;
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .pair-text-input:focus {
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .tips {
      background: #eff6ff;
      border-radius: 8px;
      padding: 16px;
      font-size: 14px;
      color: #1e40af;
    }

    .tips strong {
      display: block;
      margin-bottom: 8px;
    }

    .tips ul {
      margin-left: 20px;
    }

    .tips li {
      margin-bottom: 4px;
    }

    .empty-state {
      text-align: center;
      padding: 32px;
      color: #9ca3af;
    }

    .hidden {
      display: none;
    }

    .drop-zone {
      border: 2px dashed #d1d5db;
      border-radius: 12px;
      padding: 32px;
      text-align: center;
      cursor: pointer;
      transition: border-color 0.2s, background-color 0.2s;
      margin-bottom: 16px;
    }

    .drop-zone:hover {
      border-color: #9ca3af;
      background-color: #f9fafb;
    }

    .drop-zone.drag-over {
      border-color: #3b82f6;
      background-color: #eff6ff;
    }

    .drop-zone-icon {
      color: #9ca3af;
      margin-bottom: 12px;
    }

    .drop-zone-text {
      color: #6b7280;
      font-size: 14px;
    }

    .drop-zone-text strong {
      color: #3b82f6;
    }

    .drop-zone-hint {
      color: #9ca3af;
      font-size: 12px;
      margin-top: 8px;
    }

    .drop-zone input[type="file"] {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Memory Game Card Generator</h1>
    <p class="subtitle">Create matching pairs with text and images. Each pair becomes two cards.</p>

    <!-- Add pairs -->
    <div class="card">
      <h2>Add Card Pairs</h2>

      <div class="drop-zone" id="dropZone">
        <input type="file" id="bulkImageInput" accept="image/*" multiple>
        <div class="drop-zone-icon">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <circle cx="8.5" cy="8.5" r="1.5"></circle>
            <polyline points="21 15 16 10 5 21"></polyline>
          </svg>
        </div>
        <div class="drop-zone-text">
          <strong>Drop images here</strong> or click to browse
        </div>
        <div class="drop-zone-hint">Each image creates a pair. Edit the text inline below.</div>
      </div>

    </div>

    <!-- Pairs list -->
    <div class="card" id="pairsCard">
      <div class="header-row">
        <h2 id="pairsTitle">Your Card Pairs (0 pairs = 0 cards)</h2>
        <button class="btn btn-success" id="generateBtn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
          </svg>
          Generate PDF
        </button>
      </div>
      
      <div id="pairsList" class="pairs-list">
        <div class="empty-state">No pairs added yet. Add your first pair above!</div>
      </div>
    </div>

    <!-- Tips -->
    <div class="tips">
      <strong>Printing tips:</strong>
      <ul>
        <li>PDF is formatted for A4 paper with 4 cards per page (A7 size)</li>
        <li>Cut along the card borders</li>
      </ul>
    </div>
  </div>

  <script>
    const { jsPDF } = window.jspdf;

    let pairs = [];

    const pairsList = document.getElementById('pairsList');
    const pairsTitle = document.getElementById('pairsTitle');
    const generateBtn = document.getElementById('generateBtn');
    const dropZone = document.getElementById('dropZone');
    const bulkImageInput = document.getElementById('bulkImageInput');

    // Drop zone handlers
    dropZone.addEventListener('click', () => bulkImageInput.click());

    dropZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropZone.classList.add('drag-over');
    });

    dropZone.addEventListener('dragleave', () => {
      dropZone.classList.remove('drag-over');
    });

    dropZone.addEventListener('drop', (e) => {
      e.preventDefault();
      dropZone.classList.remove('drag-over');
      const files = Array.from(e.dataTransfer.files).filter(f => f.type.startsWith('image/'));
      processMultipleImages(files);
    });

    bulkImageInput.addEventListener('change', (e) => {
      const files = Array.from(e.target.files);
      processMultipleImages(files);
      bulkImageInput.value = '';
    });

    function processMultipleImages(files) {
      files.forEach(file => {
        const fileName = file.name.replace(/\.[^/.]+$/, '').replace(/[-_]/g, ' ');
        normalizeImage(file, (normalizedDataUrl) => {
          pairs.push({
            id: Date.now() + Math.random(),
            text: fileName,
            image: normalizedDataUrl
          });
          renderPairs();
        });
      });
    }

    function normalizeImage(file, callback) {
      const reader = new FileReader();
      reader.onload = (e) => {
        const img = new Image();
        img.onload = () => {
          const canvas = document.createElement('canvas');
          const ctx = canvas.getContext('2d');

          // If landscape, rotate to portrait
          if (img.width > img.height) {
            canvas.width = img.height;
            canvas.height = img.width;
            ctx.translate(canvas.width / 2, canvas.height / 2);
            ctx.rotate(Math.PI / 2);
            ctx.drawImage(img, -img.width / 2, -img.height / 2);
          } else {
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img, 0, 0);
          }

          callback(canvas.toDataURL('image/jpeg', 0.9));
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function removePair(id) {
      pairs = pairs.filter(p => p.id !== id);
      renderPairs();
    }

    function updatePairText(id, newText) {
      const pair = pairs.find(p => p.id === id);
      if (pair) {
        pair.text = newText;
      }
    }

    function renderPairs() {
      pairsTitle.textContent = `Your Card Pairs (${pairs.length} pairs = ${pairs.length * 2} cards)`;

      if (pairs.length === 0) {
        pairsList.innerHTML = '<div class="empty-state">No pairs added yet. Add your first pair above!</div>';
        generateBtn.style.display = 'none';
        return;
      }

      generateBtn.style.display = 'inline-flex';

      pairsList.innerHTML = pairs.map((pair, index) => `
        <div class="pair-item">
          <span class="pair-number">#${index + 1}</span>
          <div class="pair-content">
            <div class="pair-image">
              <img src="${pair.image}" alt="${escapeHtml(pair.text)}">
            </div>
            <input type="text" class="pair-text-input" value="${escapeHtml(pair.text)}"
              oninput="updatePairText(${pair.id}, this.value)" placeholder="Enter text for this card">
          </div>
          <button class="btn btn-danger" onclick="removePair(${pair.id})">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="3 6 5 6 21 6"></polyline>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
          </button>
        </div>
      `).join('');
    }

    generateBtn.addEventListener('click', generatePDF);

    function generatePDF() {
      if (pairs.length === 0) return;

      const pdf = new jsPDF({
        orientation: 'portrait',
        unit: 'mm',
        format: 'a4'
      });

      const pageWidth = 210;
      const pageHeight = 297;
      const cardWidth = 74;
      const cardHeight = 105;
      const cols = 2;
      const rows = 2;
      const gap = 8;
      const totalWidth = cols * cardWidth + (cols - 1) * gap;
      const totalHeight = rows * cardHeight + (rows - 1) * gap;
      const marginX = (pageWidth - totalWidth) / 2;
      const marginY = (pageHeight - totalHeight) / 2;

      const allCards = [];
      pairs.forEach(pair => {
        allCards.push({ type: 'text', content: pair.text });
        allCards.push({ type: 'image', content: pair.image });
      });

      // Shuffle cards
      const shuffled = [...allCards].sort(() => Math.random() - 0.5);

      // Draw cards on pages
      let cardIndex = 0;
      while (cardIndex < shuffled.length) {
        if (cardIndex > 0) pdf.addPage();

        for (let row = 0; row < rows; row++) {
          for (let col = 0; col < cols; col++) {
            if (cardIndex >= shuffled.length) break;

            const x = marginX + col * (cardWidth + gap);
            const y = marginY + row * (cardHeight + gap);
            const card = shuffled[cardIndex];

            // Card border
            pdf.setDrawColor(180);
            pdf.setLineWidth(0.3);

            if (card.type === 'text') {
              // Text card border only
              pdf.rect(x, y, cardWidth, cardHeight, 'D');

              pdf.setFontSize(18);
              pdf.setTextColor(30, 30, 30);

              const innerWidth = cardWidth - 10;
              const textLines = pdf.splitTextToSize(card.content, innerWidth);
              const lineHeight = 8;
              const textBlockHeight = textLines.length * lineHeight;
              const startY = y + (cardHeight - textBlockHeight) / 2 + lineHeight / 2;

              textLines.forEach((line, i) => {
                const textWidth = pdf.getTextWidth(line);
                pdf.text(line, x + (cardWidth - textWidth) / 2, startY + i * lineHeight);
              });
            } else {
              // Image card border only
              pdf.rect(x, y, cardWidth, cardHeight, 'D');

              try {
                pdf.addImage(
                  card.content,
                  'JPEG',
                  x,
                  y,
                  cardWidth,
                  cardHeight,
                  undefined,
                  'MEDIUM'
                );
              } catch (e) {
                console.error('Error adding image:', e);
              }
            }

            cardIndex++;
          }
        }
      }

      pdf.save('memory-game-cards.pdf');
    }

    // Initial render
    renderPairs();
  </script>
</body>
</html>
